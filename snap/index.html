<!doctype html>
<html>
  </head>
    <title></title>
    <link rel="icon" tMetaSwapype="image/svg" href="./images/icon.svg"/>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="modules/materialize.min.css">
    <script type="text/javascript" src="modules/jquery.min.js"></script>
    <script type="text/javascript" src="modules/materialize.min.js"></script>
  </head>

   <script>
    var chain1ID = 1;
    var chain1Address = "0xb68F761056eF1044eDf8E15646c8412FB86Cf6F2";
    var chain2ID = 1399811149;
    var chain2Address = "4oaeB1J7Vdv9T5AtWnXeQA587B9RS5bX7bM8m2dGRPis"
    var chain1Request = `https://api.covalenthq.com/v1/${chain1ID}/address/${chain1Address}/balances_v2/?key=ckey_af9e9219a878403b9a1abf6559e`;
    var chain2Request = `https://api.covalenthq.com/v1/${chain2ID}/address/${chain2Address}/balances_v2/?key=ckey_af9e9219a878403b9a1abf6559e`;
    var chain1Data = {};
    var chain2Data = {};

    var pullLiveData = false;

    if (pullLiveData) {
      axios.get(chain2Request).then(function (response) {
        console.log(response);
        chain1Data.balance = response.data.data.items[0].balance;
        chain1Data.ticker = response.data.data.items[0].contract_ticker_symbol
        chain1Data.USDBalance = response.data.data.items[0].quote
        chain1Data.logoURL = response.data.data.items[0].logo_url
        console.log(chain1Data.balance);
        console.log(chain1Data.ticker);
      }).catch(function (error) {
        console.log(error);
      })
    }
  </script> 

  <body>
    <nav>
      <div class="nav-wrapper">
        <a href="#" class="brand-logo">  MetaSwap</a>
        <ul id="nav-mobile" class="right hide-on-med-and-down">
        </ul>
      </div>
    </nav>

    <div style = "padding: 30px;">
        <details>
          <summary>Instructions</summary>
          <ul>
            <li>First, click "Connect". Then, try out the other buttons!</li>
    
            <input>Enter your private key here</input>
            <li>Please note that:</li>
            <ul>
              <li>
                The <code>snap.manifest.json</code> and <code>package.json</code> must be located in located in the server root directory..
              </li>
              <li>
                The Snap bundle must be hosted at the location specified by the <code>location</code> field of <code>snap.manifest.json</code>.
              </li>
            </ul>
          </ul>
        </details>
        <br/>
    
        <!-- <button class="connect">Connect</button>
        <button class="getAccount">Get Account</button> -->
    
        <a class="waves-effect waves-light btn connect">Connect Metamask</a>
        <a class="waves-effect waves-light btn getAccount">Get Account</a>
    
        <a class="waves-effect waves-light btn modal-trigger" href="#modal1">Swap</a>
        <!-- <a class="waves-effect waves-light btn">Swap</a> -->
    
    
      <div id="modal1" class="modal">
        <div class="modal-content">
          <h4>Swap</h4>
          <p>Swap currency between Ethereum and Solana (in both directions!)</p>       
          <div class="row">
            <form class="col s12">
              <div class="row">
                <div class="input-field col s6">
                  <input placeholder="Amount in USD" id="amount" type="number" class="validate">
                  <label for="first_name">Enter amount to send (in USD)</label>
                </div>
              </div>
              <div class="row">
                <div class="input-field col s12">
                  <select>
                    <option value="" disabled selected>ETH</option>
                  </select>
                  <label>Select the currency</label>
                </div>
              </div>                          
              <div class="row">
                <div class="input-field col s12">
                  <select>
                    <option value="" disabled selected>Choose your sending chain</option>
                    <option value="Ethereum">Ethereum</option>
                    <option value="Solana">Solana</option>
                  </select>
                  <label>Select the sending chain</label>
                </div>
              </div>
              <div class="row">
                <div class="input-field col s12">
                  <select>
                    <option value="" disabled selected>Choose your receiving chain</option>
                    <option value="Ethereum">Ethereum</option>
                    <option value="Solana">Solana</option>
                  </select>
                  <label>Select the receiving chain</label>
                </div>
              </div>              
            </form>
          </div>          
              
        </div>
        <div class="modal-footer">
          <a href="#!" class="modal-close waves-effect waves-green btn-flat">Send</a>
        </div>
      </div>

      <div class="row">
        <div class="col s12 m5">
          <div class="card medium">
            <div class="card-image">
              <img src="https://logos.covalenthq.com/tokens/1399811149/11111111111111111111111111111111.png" style = "width: 25%;">
              <span class="card-title">Solana</span>
            </div>
            <div class="card-content">
              <h3> 100 SOL | $1000</h3>
              <p> Address: 4oaeB1J7Vdv9T5AtWnXeQA587B9RS5bX7bM8m2dGRPis </p>
            </div>
            <div class="card-action">
              <a href="#">View on SolScan</a>
            </div>
          </div>
        </div>
    
        <div class="col s12 m5">
          <div class="card medium">
            <div class="card-image">
              <img src="https://ih1.redbubble.net/image.402690668.4075/raf,750x1000,075,t,000000:44f0b734a5.jpg" style = "width: 20%;">
              <span class="card-title">ETH</span>
            </div>
            <div class="card-content">
              <h3> 100 ETH | $1000</h3>
              <p> Address: 0xb68F761056eF1044eDf8E15646c8412FB86Cf6F2 </p>
            <div class="card-action">
              <a href="#">View on EtherScan</a>
            </div>
          </div>
        </div>  
      </div>
    
      <div class="row" >
        <h1 style = "margin-top: 40px;">Transactions</h1>
      
        <table>
          <thead>
            <tr>
                <th>Sender Address</th>
                <th>Receiver Address</th>
                <th>Amount</th>
                <th>Etherscan Link</th>
                <th>SolScan Link</th>
            </tr>
          </thead>
      
          <tbody>
            <tr>
              <td>0xb68F761056eF1044eDf8E15646c8412FB86Cf6F2</td>
              <td>4oaeB1J7Vdv9T5AtWnXeQA587B9RS5bX7bM8m2dGRPis</td>
              <td>$100</td>
              <td>https://etherscan.io/</td>
              <td>https://solscan.io/</td>
            </tr>
          </tbody>
        </table>
    </div>
    </div>
    <script>
      $(document).ready(function(){
          $('.modal').modal();});
           $('select').formSelect();
    </script>
</body>

  <script>
    const snapId = `local:${window.location.href}`;

    const connectButton = document.querySelector('a.connect')
    const getAccountButton = document.querySelector('a.getAccount')

    connectButton.addEventListener('click', connect)
    getAccountButton.addEventListener('click', getAccount)

    // here we get permissions to interact with and install the snap
    async function connect () {
      await ethereum.request({
        method: 'wallet_enable',
        params: [{
          wallet_snap: { [snapId]: {} },
        }]
      })
    }

    async function getAccount () {
      try {
        const response = await ethereum.request({
          method: 'wallet_invokeSnap',
          params: [snapId, {
            method: 'getAccount'
          }]
        })
        alert('Received account: ' + response);
      } catch (err) {
        console.error(err)
        alert('Problem happened: ' + err.message || err)
      }
    }
  </script>
</html>
